<h1>Projeto 02 - Todo-List - Classe TarefaController e TarefaService - M√©todo Consultar por Nome</h1>

O que veremos por aqui:

1. Criar o M√©todo findByNome(nome: string) na Classe TarefaService
1. Criar o M√©todo findByNome(id: string) na Classe TarefaController
1. Testar o M√©todo no Insomnia

<h2>1. O M√≥dulo Tarefa</h2>

Nas etapas anteriores, come√ßamos a construir as Classes **TarefaService** e **TarefaController** e implementamos os M√©todos:

- **findAll()**  ü°™ Retorna todos os Objetos da Classe Tarefa persistidos no Banco de dados.
- **findById(id: number)** ü°™ Retorna um Objeto espec√≠fico da Classe Tarefa persistidos no Banco de dados. A Tarefa √© identificada pelo atributo id.

Vamos continuar a constru√ß√£o das nossas duas Classes implementando o **M√©todo findByNome( nome: string )**, que retornar√° todos os Objetos da Classe Tarefa persistidos no Banco  de dados, cujo atributo nome contenha a string enviada no par√¢metro  nome do M√©todo.

```mermaid
classDiagram
class Tarefa {
  - id : number
  - nome : string
  - descricao: string
  - responsavel: string
  - data: Date
  - status: boolean
  - categoria: Categoria
  + findAll()
  + findById(id : number)
  + findByNome(nome : string)
  + create(categoria : Categoria)
  + update(categoria : Categoria)
  + delete(id : number)
}
```

<h2>üë£ Passo 01 - Criar o M√©todo findByNome(nome: string) na Classe TarefaService</h2>

Vamos implementar o M√©todo **findByNome(nome: string)** na Classe TarefaService. Tra√ßando um paralelo com o MySQL, seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_tarefas where nome like "%nome%";</code>.

1. Abra a Classe **Tarefa Service**, localizada na pasta **src/tarefa/services**.

<div align="center"><img src="https://i.imgur.com/KfZcpNC.png" title="source: imgur.com" /></div>

2. Insira o c√≥digo abaixo depois do M√©todo **findById(id: number)**.

<div align="left"><img src="https://i.imgur.com/uFsGp8h.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linha 31:** Criamos o M√©todo Ass√≠ncrono (async), chamado **findByNome(nome: string)**, que promete retornar uma **Promise** contendo um array de Objetos da Classe Tarefa. Como o **M√©todo findByNome(nome: string)** lista todos os Objetos que atendam ao crit√©rio da consulta, assim como no M√©todo findAll(), ser√° necess√°rio criar um array para armazenar todos os Objetos encontrados.

Observe que o M√©todo **findByNome(nome: string)** possui um par√¢metro do tipo **string**, chamado **nome**. Esta vari√°vel receber√° a string que voc√™ deseja procurar no Atributo nome de todas as Postagens persistidas. Qualquer tarefa, cujo **Atributo nome contenha a string enviada no par√¢metro** (seja no inicio, no meio ou no fim), ser√° adicionada no array e exibida no resultado do M√©todo. O par√¢metro nome ser√° enviado pelo M√©todo da **Classe TarefaController**. 

**Linha 32:** Retorna a execu√ß√£o do M√©todo **find()**, da Interface **tarefaRepository**. O resultado da execu√ß√£o do M√©todo **find()**, ser√° um array de Objetos Tarefa, selecionados de acordo com o(s) crit√©rio(s) da clausula where.  

Observe que na instru√ß√£o **return** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (os Objetos Tarefa sejam encontrados), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido para a Classe que acionou o M√©todo.

**Linhas 33 e 34:** Declaramos a clausula where, com o crit√©rio **ILike(`%${nome}%`)**, ou seja, **localize a Tarefa cujo atributo nome contenha, em qualquer parte, a string nome enviada no par√¢metro do M√©todo findByNome(nome: string)**. 

Observe que na consulta acima, utilizamos a clausula **ILike** ao inv√©s do tradicional **Like**. A diferen√ßa entre eles √© a seguinte:

| Clausula  | Descri√ß√£o                                                    |
| --------- | ------------------------------------------------------------ |
| **Like**  | O Like n√£o ignora se a string est√° em mai√∫sculo ou min√∫sculo, ou seja, ele faz uma busca literal. <br />**Exemplo:** GENERATION √© diferente de generation. |
| **ILike** | O ILike (Insensitive Like), ignora se a string foi digitada com letras mai√∫sculas ou min√∫sculas. Na pr√°tica o que o ILike faz √© converter a string digitada e o conte√∫do do Atributo para letras mai√∫sculas e s√≥ ent√£o ele compara as duas.<br />**Exemplo:** GENERATION √© igual a generation. |

3. Ap√≥s a implementa√ß√£o do M√©todo **findByNome(nome: string)**, observe que a linha 3 do c√≥digo, ser√° atualizada com um novo pacote, como mostra a figura abaixo (indicado pela seta amarela):

<div align="left"><img src="https://i.imgur.com/a0D5Vlc.png" title="source: imgur.com" /></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores Customizados - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - M√©todo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documenta√ß√£o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_todolist_nest/blob/06_Listar_Tarefas_por_nome/todolist/src/tarefa/services/tarefa.service.ts" target="_blank"><b>C√≥digo fonte da Classe TarefaService</b></a>
<br /><br />


<h2>üë£ Passo 02 - Criar o M√©todo findByNome(nome: string) na Classe TarefaController</h2>

Vamos implementar o M√©todo **findByNome(nome: string)** na Classe TarefaController, que tem como objetivo executar o M√©todo com o mesmo nome na Classe de Servi√ßo TarefaService. 

1. Abra a Classe **TarefaController**, localizada na pasta **src/tarefa/controllers**.

<div align="center"><img src="https://i.imgur.com/4PV6We4.png" title="source: imgur.com" /></div>

2. Insira o c√≥digo depois do M√©todo **findById(id: number)**.

<div align="left"><img src="https://i.imgur.com/JCyoFZR.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linha 21:** O decorator **@Get('/nome/:nome')** mapeia todas as Requisi√ß√µes **HTTP GET**, enviadas para um endere√ßo espec√≠fico **(/nome/:nome)**, chamado **endpoint**, dentro do M√≥dulo Tarefa, para um M√©todo espec√≠fico que responder√° a Requisi√ß√£o, ou seja, ele indica que o M√©todo **findByNome(@Param('nome') nome: string)**, responder√° a todas as requisi√ß√µes do tipo **HTTP GET**, enviadas no endere√ßo **http://localhost:4000/tarefas/nome/:nome**, onde **:nome** √© o crit√©rio de busca da consulta.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="120px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste Endpoint ser√° composto pelo Endere√ßo do M√≥dulo (/tarefas) + a vari√°vel de caminho indicada no decorator @Get (/nome/:nome). Lembre-se que n√£o pode existir dois ou mais m√©todos do tipo GET com o mesmo endere√ßo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 22:** O decorator **@HttpCode(HttpStatus.OK)** indica que o M√©todo **findByNome(@Param('nome') nome: string)**, ter√° como **Resposta HTTP** padr√£o **OK ü°™ 200**, ou seja, quando a Resposta da Requisi√ß√£o for positiva, o status  **OK ü°™ 200**. Caso a Resposta seja negativa (algo deu errado), a Resposta depender√° do erro.

**Linha 23:** Criamos o M√©todo **findByNome(@Param('nome') nome: string)**, que promete retornar uma **Promise** (que ser√° enviada pela Classe TarefaService), com um array de Objetos da Classe Tarefa. 

**@Param('nome'):** Este decorator **insere o valor enviado na vari√°vel de caminho nome (:nome)**, no par√¢metro do M√©todo **findByNome(@Param('nome') nome: string)**;

**Exemplo:**

http://localhost:4000/tarefas/nome/palavra

Neste exemplo, o par√¢metro **nome: string**, do M√©todo **findByNome(@Param('nome') nome: string)**, receber√° a string **"palavra"** (par√¢metro que ser√° enviado para a Classe TarefaService), que foi inserido na vari√°vel de caminho **/:nome**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="60px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo devem possuir o mesmo nome.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 24:** Executa o m√©todo **findByNome(nome: string)**, **M√©todo da Classe TarefaService**, que retornar√° **um array de Objetos da Classe Tarefa**, persistido no Banco de dados, segundo o crit√©rio de busca implementado. 

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Request Methods</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documenta√ß√£o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_todolist_nest/blob/06_Listar_Tarefas_por_nome/todolist/src/tarefa/controllers/tarefa.controller.ts" target="_blank"><b>C√≥digo fonte da Classe TarefaController</b></a></div>

<br />


<h2>üë£ Passo 03 - Executar o projeto</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/kXggbYz.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, observe na imagem abaixo, na regi√£o indicada em amarelo, que o endpoint do tipo **GET**, apontando para o caminho (rota) **/tarefas/nome/:nome**, foi disponibilizado.

<div align="center"><img src="https://i.imgur.com/uz1X0wf.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 04 - Testar no Insomnia</h2>

Agora vamos criar a Requisi√ß√£o para o M√©todo **findByNome(nome: string)**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Tarefa** para abrir o menu e clique na op√ß√£o **New Request**.

<div align="center"><img src="https://i.imgur.com/6CwyPRd.png?1" title="source: imgur.com" /></div>

2.  Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Tarefa**.

<div align="center"><img src="https://i.imgur.com/ZRXvMAk.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova Requisi√ß√£o (**New Request**), informe o nome da Requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/mStDpWH.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na Requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure o endere√ßo da Requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/8GrA1gM.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A Requisi√ß√£o **Consultar Tarefa por Nome** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (http://localhost:4000) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem (Exemplo: http://nomedaaplicacao.herokuapp.com).
- A segunda parte do endere√ßo √© o **endpoint** configurado no Decorator ***@Controller***, em nosso caso **/tarefas**.  
- A terceira parte (**/nome**) √© a vari√°vel de caminho (**@Param('nome')**) **nome**. Informe a palavra, frase ou letra que voc√™ deseja procurar.

7. Para testar a Requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="50px"/>.

8. O resultado da Requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/mnjNigu.png" title="source: imgur.com" /></div>

9. Observe que a aplica√ß√£o al√©m de exibir os dados de todos os Objetos da Classe Tarefa persistidos no Banco de dados, no Corpo da Resposta, respeitando o crit√©rio informado na consulta (palavra tarefa), ela tamb√©m retornar√° um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_todolist_nest/tree/06_Listar_Tarefas_por_nome" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>