<h1>Projeto 02 - Todo-List - M√≥dulo Tarefa</h1>

O que veremos por aqui:

1. Apresenta√ß√£o do M√≥dulo Tarefa
2. Criar a estrutura de Pastas do M√≥dulo Tarefa
3. Criar a Classe Entidade Tarefa
4. Registrar a Classe Tarefa nos M√≥dulos TarefaModule e AppModule

<h2>1. O M√≥dulo Tarefa</h2>

Nesta etapa vamos come√ßar a construir o M√≥dulo Tarefa. Veja o Diagrama de Classes abaixo: 

```mermaid
classDiagram
class Tarefa {
  - id : number
  - nome : string
  - descricao: string
  - responsavel: string
  - data: Date
  - status: boolean
  - categoria: Categoria
  + findAll()
  + findById(id : number)
  + findByDescricao(descricao : string)
  + create(categoria : Categoria)
  + update(categoria : Categoria)
  + delete(id : number)
}
```

<br />

Primeiro vamos construir a **Classe Entidade Tarefa (Model no modelo MVC)**, que ser√° utilizada como modelo para construir a tabela **tb_tarefas** (Entidade) dentro do nosso Banco de dados **db_todolist**. Os campos (Atributos) da tabela ser√£o os mesmos que est√£o definidos no Diagrama de Classes acima. Na pr√≥xima etapa vamos come√ßar a construir as Classes **TarefaService** (Regras de neg√≥cio da aplica√ß√£o) e **TarefaController** (Os m√©todos do CRUD descritos no Diagrama de Classes).

> **CRUD:** √â um acr√¥nimo para **Create** (Persistir dados na tabela), **Read** (Pesquisar dados na tabela), **Update** (Atualizar dados da tabela) e **Delete** (Apagar dados da tabela), ou seja, s√£o os M√©todos para interagirmos com as tabelas do nosso Banco de dados.

Depois de criar a Classe Entidade Tarefa, vamos executar o projeto Todo-List no Nest. Ap√≥s a execu√ß√£o veremos que ser√° criado dentro do Banco de dados **db_todolist**, a tabela **tb_tarefas**. Veja abaixo como ficar√° a estrutura da nossa tabela atrav√©s do **Diagrama de Entidade e Relacionamentos (DER)** da tabela tb_tarefas:

```mermaid
erDiagram
    TAREFA {
        INT id
        VARCHAR nome
        VARCHAR descricao
        VARCHAR responsavel
        DATE data
        BOOLEAN status
    }
   
```

O **Dicion√°rio de dados da nossa tabela tb_tarefas** ser√° o seguinte:

| Atributo      | Tipo de dado  | Descri√ß√£o                             | Chave |
| ------------- | ------------- | ------------------------------------- | ----- |
| **id**        | INT           | Identificador √∫nico                   | PK    |
| **nome**      | VARCHAR(30)   | Nome da Tarefa                        |       |
| **descricao** | VARCHAR(5000) | Detalhes da Tarefa                    |       |
| responsavel   | VARCHAR(5000) | Respons√°vel pela Tarefa               |       |
| **data**      | DATETIME      | Data da cria√ß√£o/atualiza√ß√£o da Tarefa |       |
| status        | BOOLEAN       | Status da Tarefa                      |       |

<h2>üë£ Passo 01 - Criar o M√≥dulo Tarefa</h2>

O **M√≥dulo**, no contexto Nest, √© uma pasta utilizada para organizar a estrutura da nossa aplica√ß√£o em componentes. Para cada tabela que inserirmos no Banco de dados da nossa aplica√ß√£o ser√° necess√°rio criar um M√≥dulo para interagir com os dados da tabela (CRUD).

O M√≥dulo √© composto basicamente por 4 Classes:

| Classes        | Descri√ß√£o                                                    |
| -------------- | ------------------------------------------------------------ |
| **Module**     | Classe principal do M√≥dulo, onde s√£o definidas as Estruturas de dados, Relacionamentos e Depend√™ncias. As Classes Entidade, Service e Controller obrigatoriamente devem ser Registradas na Classe M√≥dulo, assim como a Classe M√≥dulo tamb√©m deve ser registrada no M√≥dulo raiz da aplica√ß√£o (**AppModule**). |
| **Entidade**   | Classe respons√°vel pela abstra√ß√£o dos nossos Objetos em Registros (linhas) nas Tabelas do Banco de dados. As Classes Entidade representam os Objetos que ser√£o persistidos no Banco de dados. As Classes Entidade tamb√©m s√£o utilizadas pelo TypeORM como modelo para criar automaticamente as nossas tabelas no Banco de dados. |
| **Service**    | Classe respons√°vel por implementar as regras de neg√≥cio da aplica√ß√£o e o tratamento dos dados, antes de serem persistidos no Banco de dados. <br />**Exemplo:** N√£o √© permitido salvar no Banco de dados 2 usu√°rios com o mesmo endere√ßo de e-mail. <br />O M√©todo Cadastrar Usu√°rio implementaria esta regra para checar se o e-mail j√° foi cadastrado, antes de Salvar os dados do novo usu√°rio. |
| **Controller** | Classe respons√°vel por receber todas as Requisi√ß√µes HTTP (HTTP Request), enviadas por um Cliente HTTP (Client de testes ou o front-end), para a nossa aplica√ß√£o e Responder (HTTP Response) as requisi√ß√µes de acordo com o resultado do processamento da requisi√ß√£o na Classe de Servi√ßo. |

A estrutura de M√≥dulo descrita acima √© a estrutura b√°sica. Dependendo das necessidades da aplica√ß√£o, pode ser necess√°rio gerar mais de uma Classe Entidade, Service e Controller. Pode ser necess√°rio tamb√©m a implementa√ß√£o de Classes auxiliares, com fun√ß√µes espec√≠ficas dentro do Module. Apenas a Classe M√≥dulo ser√° √∫nica dentro do M√≥dulo. Para utilizar uma Classe Servi√ßo ou auxiliar em outro M√≥dulo √© necess√°rio registrar a exporta√ß√£o na Classe M√≥dulo.

Vamos criar o nosso primeiro M√≥dulo:

1. Na pasta **src**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

<div align="center"><img src="https://i.imgur.com/PaSVfva.png" title="source: imgur.com" /></div>

2. O nome da pasta ser√° **tarefa**, como mostra a figura abaixo. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/HFq9Jiu.png" title="source: imgur.com" /></div>

3. Caso voc√™ precise alterar o nome da pasta, clique com o bot√£o direito do mouse e clique na op√ß√£o **Rename** (Renomear) como mostra a figura abaixo. Digite o novo nome da pasta e pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/0zxqizb.png" title="source: imgur.com" /></div>

Na sequ√™ncia, vamos criar a pasta **entities**, dentro do nosso **M√≥dulo Tarefa** (pasta tarefa):

1. Na pasta **Tarefa**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

<div align="center"><img src="https://i.imgur.com/mcD3zCu.png" title="source: imgur.com" /></div>

2. O nome da pasta ser√° **entities**, como mostra a figura abaixo. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/97u7OQX.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a Classe Entidade. Um erro muito comum √© criar a pasta entities fora da pasta do M√≥dulo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<h2>üë£ Passo 02 - Criar a Classe TarefaModule na pasta Tarefa</h2>

Agora vamos criar a Classe **TarefaModule** que chamaremos de **tarefa.module.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="220px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe Module. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest *(nome_do_modulo.tipo_da_classe.ts)* para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o bot√£o direito do mouse sobre a **pasta tarefa**, que foi criada dentro da pasta **src**, como mostra a figura abaixo, e clique na op√ß√£o **New File** (Novo Arquivo).

<div align="center"><img src="https://i.imgur.com/oLQu9Me.png" title="source: imgur.com" /></div>

2. O nome do arquivo ser√° **tarefa.module.ts**, como mostra a figura abaixo. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/XoKcgvy.png" title="source: imgur.com" /></div>

<h2>üë£ Passo 03 - Criar a Classe Tarefa na pasta Entities</h2>

Antes de implementarmos o c√≥digo da Classe **TarefaModule**, vamos criar a Classe Entidade **Tarefa** que chamaremos de **tarefa.entity.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="220px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe Entidade. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest *(nome_do_modulo.tipo_da_classe.ts)* para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o bot√£o direito do mouse sobre a **pasta entities**, que foi criada dentro da pasta **Tarefa**, como mostra a figura abaixo, e clique na op√ß√£o **New File** (Novo Arquivo).

<div align="center"><img src="https://i.imgur.com/tjH6b4X.png" title="source: imgur.com" /></div>

2. O nome do arquivo ser√° **tarefa.entity.ts**, como mostra a figura abaixo. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/9NnjKLc.png" title="source: imgur.com" /></div>

Agora vamos criar o c√≥digo da Classe **Tarefa**, como mostra a figura abaixo:

<div align="left"><img src="https://i.imgur.com/fXYIgo8.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 1:** Importamos o pacote **Validation** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe Tarefa.

**Linha 2:** Importamos o pacote **TypeORM** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe Tarefa.

**Linha 4:** O decorator **@Entity** indica que esta classe define uma entidade, ou seja, ela ser√° utilizada para gerar uma tabela no Banco de dados da aplica√ß√£o. O par√¢metro name, indica o nome da tabela no Banco de dados (**tb_tarefas**). Caso este par√¢metro n√£o seja declarado, o TypeORM criar√° a tabela com o mesmo nome da Classe Entidade (Tarefa). 

Observe que o nome da Tabela segue o padr√£o **tb_nome_da_tabela** (tb_tarefas). O prefixo **tb** indica que se trata de uma Table (Tabela). O nome da Tabela √© recomendado que seja **o mesmo da Classe Entidade** (Tarefa), em **letras min√∫sculas**, **sem espa√ßos em branco ou caracteres especiais e acentos**. 

**Linhas 7, 13, 17, 21, 24 e 27:** foram criados os Atributos da Classe Tarefa, que foram definidos no Diagrama de Classes acima. Veja na tabela abaixo a convers√£o de **Tipo de dados TypeScript ü°™ MySQL**

| Atributo        | Tipo de dado TypeScript | Tipo de dado MySQL |
| --------------- | ----------------------- | ------------------ |
| **id**          | <i>number</i>           | INT                |
| **nome**        | <i>string</i>           | VARCHAR(30)        |
| **descricao**   | <i>string</i>           | VARCHAR(5000)      |
| **responsavel** | <i>string</i>           | VARCHAR(5000)      |
| **data**        | <i>Date</i>             | DATETIME           |
| **status**      | boolean                 | BOOLEAN            |

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left">**DICA:** *Para relembrar os tipos de dados do TypeScript, <a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html">clique aqui</a> e explore os principais tipos de dados oferecidos pelo TypeScript.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Observe que acima de cada atributo foram adicionados alguns **decorators**. Estes decorators tem a fun√ß√£o de configurar as propriedades dos atributos e criar valida√ß√µes para os dados que ser√£o inseridos no Objeto (tamanho, formato e etc)

**Linhas 7:** O decorator **@PrimaryGeneratedColumn** inidica que o Atributo id ser√° a **Chave Prim√°ria** (Primary Key - PK) da Tabela **tb_tarefas** e que esta **Chave Prim√°ria** ser√° gerada pelo Banco de dados, atrav√©s da propriedade **auto-incremento** (auto-increment), que gera uma sequ√™ncia num√©rica iniciando em 1.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *N√£o confundir o auto-incremento do Banco de Dados que inicia em 1 com o indice de um array (Vetor ou Matriz) que inicia em 0.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Nas linhas 10, 15 e 19:** O decorator **@IsNotEmpty** faz parte do pacote **Validation** e define que o valor do Atributo n√£o pode ser vazio, ou seja, precisa ser enviado algum valor. 

**Linha 11:** O decorator **@MaxLength(30)** faz parte do pacote **Validation** e define que o valor do Atributo n√£o pode ter mais do que 30 caracteres. 

**Nas linhas 12, 16, 20, 23 e 26:** O decorator **@Column** define que o atributo ser√° inserido na estrutura da Tabela, ou seja, se voc√™ n√£o declarar o decorator **@Column** (exceto no atributo **Chave Prim√°ria**), o atributo n√£o ser√° inserido na  estrutura da tabela. 

<h4>Propriedades do decorator @Column</h4>

| Propriedade  | Descri√ß√£o                                                    |
| ------------ | ------------------------------------------------------------ |
| **length**   | Define o tamanho do atributo string no Banco de dados.       |
| **nullable** | Define se o atributo pode ser nulo (null). <br />**false** = N√£o pode ser nulo<br />**true** = pode ser nulo |

Existem outras propriedades que podem ser consultadas na documenta√ß√£o do **TypeORM** nos links abaixo.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/database" target="_blank"><b>Documenta√ß√£o: <i>Banco de dados com Nest</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/entities" target="_blank"><b>Documenta√ß√£o: <i>Entidades no TypeORM</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/6knlnLz.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/typestack/class-validator" target="_blank"><b>Documenta√ß√£o: <i>Pacote Validation</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="3%"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe Tarefa</b></a></div>


<br />

<h2>üë£ Passo 04 - Registrar a Classe Tarefa na Classe TarefaModule</h2>

Vamos implementar o c√≥digo da Classe **TarefaModule** e registrar a Classe **Tarefa** no M√≥dulo Tarefa. O c√≥digo da Classe **Tarefa** ser√° implementado conforme a figura abaixo:

<div align="left"><img src="https://i.imgur.com/halhI6F.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 1:** Importamos o pacote **Common** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe TarefaModule.

**Linha 2:** Importamos o pacote **TypeORM** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe TarefaModule.

**Linha 3:** Importamos a Classe **Tarefa**, criada anteriormente. Observe que na importa√ß√£o da Classe foi utilizado o caminho relativo (**./entities/tarefa.entity.ts**) ao inv√©s do caminho absoluto (**src/entities/tarefa.entity.ts**) por quest√µes de boas pr√°ticas. 

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Se uma Classe for importada com o caminho absoluto, os testes da aplica√ß√£o com o framework Jest n√£o ser√£o executados. O Jest n√£o reconhece caminho absoluto, apenas caminho relativo* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 5:** O decorator **@Module** indica que esta classe ser√° a Classe principal do M√≥dulo, ou seja, nela registraremos todas as Classes (Entidade, Service e Controller) criadas dentro do M√≥dulo. 

**Linha 6:** No array **imports** vamos importar todas as **Classes Entidade** (Model) do M√≥dulo, atrav√©s do M√©todo **forFeature**, da Classe **TypeOrmModule**. Observe que importamos a Classe Entidade **Tarefa**.

**Linha 7:** No array **providers** vamos importar todas as **Classes de Servi√ßo** do M√≥dulo. Como n√£o temos nenhuma Classe de servi√ßo implementada, vamos deix√°-lo vazio.

**Linha 8:** No array **controllers** vamos importar todas as **Classes Controladora** do M√≥dulo. Como n√£o temos nenhuma Classe controladora implementada, vamos deix√°-lo vazio.

**Linha 9:** No array **exports** vamos importar todas as **Classes** do M√≥dulo que precisam estar dispon√≠veis para outros M√≥dulos. Como teremos que registrar a Classe **Tarefa** no M√≥dulo principal da aplica√ß√£o (**AppModule**), vamos inserir no array a Classe do TypeORM utilizada para registrar a Classe Tarefa (**TypeOrmModule**).

**Linha 11:** Exportamos a Classe **TarefaModule**. Desta forma, o M√≥dulo **TarefaModule** ficar√° dispon√≠vel para ser registrado no M√≥dulo principal **AppModule**.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe TarefaModule</b></a></div>

<br />

<h2>üë£ Passo 05 - Registrar a Classe Tarefa na Classe AppModule</h2>

Para finalizar, vamos registrar a Classe **Tarefa** no M√≥dulo principal da  aplica√ß√£o (**AppModule**). 

1. Abra a Classe **AppModule**, localizada na pasta **src**, conforme indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/atwci1S.png" title="source: imgur.com" /></div>

2. Implemente as duas altera√ß√µes, indicadas pelas setas na imagem abaixo:

<div align="left"><img src="https://i.imgur.com/DCAd8Ur.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 3:** Importamos a Classe **Tarefa**, criada anteriormente. Observe que na importa√ß√£o da Classe foi utilizado o caminho relativo (**./tarefa/entities/tarefa.entity.ts**) ao inv√©s do caminho absoluto (**src/tarefa/entities/tarefa.entity.ts**) por quest√µes de boas pr√°ticas. 

**Linha 14:** No array **entities** vamos importar todas as **Classes Entidade** (Model) do m√≥dulo. Insira no array a Classe **Tarefa**.

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Todas as Classes Entidade devem ser registradas no M√≥dulo principal da aplica√ß√£o (AppModule), caso contr√°rio a Tabela n√£o ser√° criada no Banco de dados.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe AppModule</b></a></div>

<br />

<h2>üë£ Passo 06 - Executar o projeto</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/kXggbYz.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **todolist**, caso ele n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, o resultado ser√° semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/nEAKeP5.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="30px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br />


<h2>üë£ Passo 07 - Checar se a Tabela foi criada no Banco de Dados</h2>

Vamos checar no Banco de Dados **db_todolist** se a Tabela **tb_tarefas** foi criada.

1. Abra o MySQL Workbench
2. Na janela **Navigator**, Clique no bot√£o <img src="https://i.imgur.com/UANRDni.png" title="source: imgur.com" /> (Atualizar)

<div align="center"><img src="https://i.imgur.com/CyGGFdy.png" title="source: imgur.com" /></div>

3. Verifique no Banco de dados **db_todolist** se a tabela **tb_tarefas** foi criada corretamente, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/r40fyuE.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="3%"/> <a href="mudar" target="_blank"><b>C√≥digo fonte do Projeto</b></a></div>

<br /><br />

<h2>Anexo I - Erros comuns</h2>

| Erro                                   | Descri√ß√£o                                                    |
| -------------------------------------- | ------------------------------------------------------------ |
| **No metadata for 'Tarefa' was found** | A Classe Tarefa n√£o foi registrada no M√≥dulo AppModule. Verifique se voc√™ fez o registro da Classe Tarefa na Classe AppModule e na Classe TarefaModule. |

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
