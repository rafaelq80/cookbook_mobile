<h1>Projeto 02 - Blog Pessoal - Classe TarefaController e TarefaService - M√©todo Consultar por Id</h1>

O que veremos por aqui:

1. Criar o M√©todo findById(id: number) na Classe TarefaService
2. Criar o M√©todo findById(id: number) na Classe TarefaController
3. Testar o M√©todo no Insomnia

<h2>1. O M√≥dulo Tarefa</h2>

Na etapa anterior, come√ßamos a construir as Classes **TarefaService** e  **TarefaController**, al√©m de  implementamos o M√©todo **findAll()**, que retorna todos os Objetos da Classe Tarefa persistidos no Banco de dados. Vamos continuar a constru√ß√£o das nossas Classes implementando o **M√©todo findById( id: number )**.

```mermaid
classDiagram
class Tarefa {
  - id : number
  - nome : string
  - descricao: string
  - responsavel: string
  - data: Date
  - status: boolean
  - categoria: Categoria
  + findAll()
  + findById(id : number)
  + findByDescricao(descricao : string)
  + create(categoria : Categoria)
  + update(categoria : Categoria)
  + delete(id : number)
}
```

<h2>üë£ Passo 01 - Criar o M√©todo findById(id: number) na Classe TarefaService</h2>

Vamos implementar o M√©todo **findById(id: number)** na Classe TarefaService. Tra√ßando um paralelo com o MySQL, seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_tarefas where id = id;</code>.

1. Abra a Classe **Tarefa Service**, localizada na pasta **src/tarefa/services**.

<div align="center"><img src="https://i.imgur.com/KfZcpNC.png" title="source: imgur.com" /></div>

2. Insira o c√≥digo abaixo depois do M√©todo **findAll()**.

<div align="left"><img src="https://i.imgur.com/zzMceFS.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linha 18:** Criamos o M√©todo Ass√≠ncrono (async), chamado **findById(id: number)**, que promete retornar uma **Promise** com **apenas um** Objeto da Classe Tarefa. Como o M√©todo **findById(id: number)** lista apenas um Objeto espec√≠fico, diferente do M√©todo findAll() que lista todos, ser√° necess√°rio criar apenas um Objeto para armazenar o Objeto procurado.

Observe que o M√©todo **findById(id: number)** possui um par√¢metro do tipo **number**, chamado **id**. Esta vari√°vel receber√° o id da Tarefa que voc√™ deseja procurar. O id ser√° enviado pelo M√©todo da **Classe TarefaController**. 

**Linha 19:** Criamos um Objeto da Classe tarefa, chamado **tarefa**, que receber√° o resultado da execu√ß√£o do M√©todo **findOne()**, da Interface **tarefaRepository**, que retorna apenas um Objeto espec√≠fico, de acordo com o(s) crit√©rio(s) da clausula where. Tra√ßando um paralelo com o MySQL, o M√©todo findOne() seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_tarefas where id = id_procurado;</code>. 

Observe que na instru√ß√£o **return** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (o Objeto Tarefa seja encontrado e inserido no Objeto Tarefa criado na Promise na linha 17), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido para a Classe que acionou o M√©todo.

**Linhas 20 e 21:** Declaramos a clausula where, com o crit√©rio id, ou seja, **localize a Tarefa cujo atributo id seja igual ao id enviado no par√¢metro do M√©todo findById(id: number)**.

**Linha 25:** Verifica se a Tarefa n√£o foi encontrada. Caso o usu√°rio digite um id que n√£o exista, o Objeto Tarefa ser√° nulo, causando um erro na nossa aplica√ß√£o. Para evitar este erro, checamos se o Objeto tarefa, criado na linha 19, √© nulo (!tarefa).

**Linha 26:** Se o Objeto tarefa n√£o for encontrado (Nulo), ser√° retornado o HTTP Status **NOT FOUND ü°™ 404** (N√£o Encontrado!).

**Linha 28:** Se o Objeto tarefa for encontrado, o M√©todo retorna o Objeto tarefa para a Classe que acionou o M√©todo.

3. Ap√≥s a implementa√ß√£o do M√©todo findById(id: number), observe que a linha 1 do c√≥digo, ser√° atualizada com alguns novos pacotes, como mostra a figura abaixo (indicado pela seta amarela):

<div align="left"><img src="https://i.imgur.com/RPVOk3E.png" title="source: imgur.com" /></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores Customizados - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - M√©todo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documenta√ß√£o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe TarefaService</b></a></div>


<br /><br />

<h2>üë£ Passo 02 - Criar o M√©todo findById(id: number) na Classe TarefaController</h2>

Vamos implementar o M√©todo **findById(id: number)** na Classe TarefaController, que tem como objetivo executar o M√©todo com o mesmo nome na Classe de Servi√ßo TarefaService. 

1. Abra a Classe **TarefaController**, localizada na pasta **src/tarefa/controllers**.

<div align="center"><img src="https://i.imgur.com/4PV6We4.png" title="source: imgur.com" /></div>

2. Insira o c√≥digo depois do M√©todo **findAll()**.

<div align="left"><img src="https://i.imgur.com/C8nmgbm.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linha 15:** O decorator **@Get('/:id')** mapeia todas as Requisi√ß√µes **HTTP GET**, enviadas para um endere√ßo espec√≠fico **(/:id)**, chamado **endpoint**, dentro do M√≥dulo Tarefa, para um M√©todo espec√≠fico que responder√° a Requisi√ß√£o, ou seja, ele indica que o M√©todo **findById(@Param('id', ParseIntPipe) id: number)**, responder√° a todas as requisi√ß√µes do tipo **HTTP GET**, enviadas no endere√ßo **http://localhost:4000/tarefas/:id**, onde **:id** √© o id da Tarefa que voc√™ deseja encontrar.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste Endpoint ser√° composto pelo Endere√ßo do M√≥dulo (/tarefas) + a vari√°vel de caminho indicada no decorator @Get (:id). Lembre-se que n√£o pode existir dois ou mais m√©todos do tipo GET com o mesmo endere√ßo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 16:** O decorator **@HttpCode(HttpStatus.OK)** indica que o M√©todo **findById()**, ter√° como **Resposta HTTP** padr√£o o status **OK ü°™ 200**, ou seja, quando a Resposta da Requisi√ß√£o for positiva, ser√° retornado o **HTTP Status OK ü°™ 200**. Caso a Resposta seja negativa (algo deu errado), a Resposta depender√° do erro.

**Linha 17:** Criamos o M√©todo **findById(@Param('id', ParseIntPipe) id: number)**, que promete retornar uma **Promise** (que ser√° enviada pela Classe TarefaService), com um Objeto da Classe Tarefa. 

**@Param('id'):** Este Decorator **insere o valor enviado na vari√°vel de caminho id (:id)**, no par√¢metro do M√©todo **findById( @Param('id') id: number )**;

**Exemplo:**

http://localhost:4000/tarefas/1

Neste exemplo, o par√¢metro **id: number**, do M√©todo  **findById( @Param('id') id: number )**, receber√° o valor 1 (Id que ser√° procurado na tabela tb_tarefas), que foi enviado na vari√°vel de caminho **/:id**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo devem possuir o mesmo nome.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**ParseIntPipe:** Converte o valor da vari√°vel de caminho id (inicialmente uma string) em um numero. Caso n√£o seja poss√≠vel converter (o usu√°rio digitou algo diferente de um numero), ele retorna uma mensagem de erro de valida√ß√£o,  informando que estava esperando por um numero e recebeu uma string, al√©m do HTTP Status **BAD REQUEST ü°™ 400** (Erro no conte√∫do da  Requisi√ß√£o), como mostra a figura abaixo

<div align="center"><img src="https://i.imgur.com/Zetp0hh.png" title="source: imgur.com" /></div>

**Linha 18:** Executa o m√©todo **findById( id: number )**, **M√©todo da Classe TarefaService**, que retornar√° **apenas um Objeto espec√≠fico da Classe Tarefa**, persistido no Banco de dados, caso seja encontrado. Caso n√£o seja encontrado, o M√©todo **findById( id: number )** retornar√° o HTTP Status **NOT FOUND ü°™ 404** (N√£o Encontrado!). 

3. Ap√≥s a implementa√ß√£o do M√©todo **findById( @Param('id', ParseIntPipe) id: number )**, observe que a linha 1 do c√≥digo ser√° atualizada com alguns novos pacotes, como mostra a figura abaixo (indicado pela seta amarela):

<div align="left"><img src="https://i.imgur.com/21xyIFZ.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Methods Request</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documenta√ß√£o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe TarefaController</b></a></div>

<br />


<h2>üë£ Passo 03 - Executar o projeto</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/kXggbYz.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, observe na imagem abaixo, na regi√£o indicada em amarelo, que o endpoint do tipo **GET**, apontando para o caminho (rota) **/tarefas/:id**, foi disponibilizado.

<div align="center"><img src="https://i.imgur.com/0n5cDqE.png?1" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="30px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte do projeto</b></a>

<br />

<h2>üë£ Passo 04 - Testar no Insomnia</h2>

Agora vamos criar a Requisi√ß√£o para o M√©todo **findById( id: number )**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Tarefa** para abrir o menu e clique na op√ß√£o **New Request**.

<div align="center"><img src="https://i.imgur.com/6CwyPRd.png?1" title="source: imgur.com" /></div>

2.  Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Tarefa**.

   <div align="center"><img src="https://i.imgur.com/ZRXvMAk.png" title="source: imgur.com" /></div>

   2. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

      <div align="center"><img src="https://i.imgur.com/piMQLDF.png" title="source: imgur.com" /></div>

   2. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

   <div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

   3. Configure o endere√ßo da requisi√ß√£o conforme a imagem abaixo:

   <div align="center"><img src="https://i.imgur.com/IqjUy7F.png" title="source: imgur.com" /></div>

4. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Consultar tarefa por ID** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (http://localhost:4000) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem (Exemplo: http://nomedaaplicacao.herokuapp.com).
- A segunda parte do endere√ßo √© o **endpoint** configurado no Decorator ***@Controller***, em nosso caso **/tarefas**.  
- A terceira parte (**/1**) √© a vari√°vel de caminho (**@Param('id')**) **id**. Informe o id da tarefa que voc√™ deseja procurar.

5. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

6. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/jP69xzh.png" title="source: imgur.com" /></div>

7. Observe que a aplica√ß√£o quando encontra o Objeto no Banco de dados, al√©m de exibir os dados do Objeto no Corpo da Resposta, respeitando o crit√©rio informado na consulta (id 1), ela tamb√©m retorna um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!

8. Caso o Objeto Tarefa n√£o seja encontrado, a aplica√ß√£o retornar√° o **HTTP Status 404 ü°™ NOT FOUND** (N√£o encontrado), marcado em laranja na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/5lCAhBv.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
