<h1>Teste de Software - Jest - Testes do M√≥dulo Tarefa</h1>

<h2>üë£ Passo 01 - Implementar os Testes</h2>

Antes de come√ßar a implementar os M√©todos de teste, vamos criar uma vari√°vel auxiliar (**tarefaId**), antes do M√©todo **beforeAll()**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/FWif7XD.png" title="source: imgur.com" /></div>

Na sequ√™ncia, vamos implementar os testes logo abaixo do M√©todo **afterAll()**.

<h3>M√©todo 01 - Deve Cadastrar uma Tarefa</h3>

<div align="center"><img src="https://i.imgur.com/KYNwByV.png" title="source: imgur.com" /></div>

**Linha 40:** O M√©todo que executar√° o Teste **Deve Cadastrar uma Tarefa** foi criado com o M√©todo **it()** que indica que este M√©todo executar√° um teste.

**Linha 41:** Foi criada uma  **const**, chamada **resposta**, que receber√° a excu√ß√£o do M√©todo **request()**, que cria uma Requisi√ß√£o que ser√° enviada para a aplica√ß√£o que foi gerada pelo Nest com o ambiente de testes.

**Linha 42:** Define que a Requisi√ß√£o ser√° do tipo **POST**, atrav√©s do M√©todo **post()**, e enviar√° a Requisi√ß√£o para o endere√ßo do endpoint Cadastrar Tarefa (**/tarefas**).

**Linha 43:** Define os dados do Objeto Tarefa que ser√£o enviados no Corpo da Requisi√ß√£o, atrav√©s do M√©todo send(). Nesta etapa, o processo √© equivalente ao que o Insomnia faz em uma requisi√ß√£o do tipo **POST**: Transforma os atributos num Objeto da Classe Tarefa, que ser√° enviado no corpo da requisi√ß√£o (Request Body).

**Linha 50:** Atrav√©s do M√©todo <b>expect()</b>, da Biblioteca SuperTest, checaremos se a Resposta HTTP da Requisi√ß√£o (Response), √© a resposta esperada (**CREATED ü°™ 201**). Caso o HTTP Status da Resposta da Requisi√ß√£o seja 201, o **Teste Passa**. Caso seja outro Status, o **Teste Falha**.

**Linha 52:** Vamos armazenar na vari√°vel **tarefaId** o Atributo **id** da tarefa cadastrada, porqu√™ iremos utilizar o id em outros testes. Para obter o id, vamos utilizar o M√©todo **resposta.body.id**, para extrair o Atributo id do Corpo da Resposta da Requisi√ß√£o.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/testing" target="_blank"><b>Documenta√ß√£o: NestJS Testing</b></a></div>

<div align="left"><img src="https://i.imgur.com/3tsv1lE.png" title="source: imgur.com" width="30px"/> <a href="https://jestjs.io/pt-BR/docs/api" target="_blank"><b>Documenta√ß√£o: Jest</b></a></div>

<div align="left"><img src="https://i.imgur.com/kuK7aM3.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/visionmedia/supertest#readme" target="_blank"><b>Documenta√ß√£o: Supertest</b></a></div>



<h3>M√©todo 02 - Deve Listar uma Tarefa Espec√≠fica</h3>

<div align="center"><img src="https://i.imgur.com/zMIHn0Y.png" title="source: imgur.com" /></div>

**Linha 55:** O M√©todo que executar√° o Teste **Deve Listar uma Tarefa Espec√≠fica** foi criado com o M√©todo **it()** que indica que este M√©todo executar√° um teste.

**Linha 56:** Neste M√©todo, como n√£o iremos extrair nenhum atributo do Corpo da Requisi√ß√£o, n√£o foi criado uma **const**. Utilizamos a palavra **return** que executar√° e retornar√° a Resposta do M√©todo **request()**, que cria uma Requisi√ß√£o que ser√° enviada para a aplica√ß√£o que foi gerada pelo Nest com o ambiente de testes.

**Linha 57:** Define que a Requisi√ß√£o ser√° do tipo **GET**, atrav√©s do M√©todo **get()**,  e enviar√° a Requisi√ß√£o para o endere√ßo do endpoint Consultar Tarefa por id(**/tarefas/:id**).

Observe que para enviarmos o id da tarefa na vari√°vel de caminho id, do **M√©todo findById(id : number)**, criamos uma concatena√ß√£o entre o **endere√ßo do M√≥dulo (/tarefas)** e a **vari√°vel auxiliar (tarefaId)**. Desta forma, conseguimos criar o endere√ßo da Requisi√ß√£o: **/tarefas/id_da_tarefa**

**Linha 58:** Como as requisi√ß√µes do tipo **GET** n√£o enviam dados no corpo da requisi√ß√£o (Request Body), o M√©todo **send()** ficar√° vazio.

**Linha 59:** Atrav√©s do M√©todo <b>expect()</b>, da Biblioteca SuperTest, checaremos se a Resposta HTTP da Requisi√ß√£o (Response), √© a resposta esperada (**OK ü°™ 200**). Caso o HTTP Status da Resposta da Requisi√ß√£o seja 200, o **Teste Passa**. Caso seja outro Status, o **Teste Falha**.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/testing" target="_blank"><b>Documenta√ß√£o:  NestJS Testing</b></a></div>

<div align="left"><img src="https://i.imgur.com/3tsv1lE.png" title="source: imgur.com" width="30px"/> <a href="https://jestjs.io/pt-BR/docs/api" target="_blank"><b>Documenta√ß√£o: Jest</b></a></div>

<div align="left"><img src="https://i.imgur.com/kuK7aM3.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/visionmedia/supertest#readme" target="_blank"><b>Documenta√ß√£o: Supertest</b></a></div>



<h3>M√©todo 03 - Deve atualizar uma Tarefa</h3>

<div align="center"><img src="https://i.imgur.com/Zid4o5z.png" title="source: imgur.com" /></div>

**Linha 64:** O M√©todo que executar√° o Teste **Deve Atualizar Uma Tarefa** foi criado com o M√©todo **it()** que indica que este M√©todo executar√° um teste.

**Linha 65:** Neste M√©todo, como n√£o iremos extrair nenhum atributo do Corpo da Requisi√ß√£o, n√£o foi criado uma **const**. Utilizamos a palavra **return** que executar√° e retornar√° a Resposta do M√©todo **request()**, que cria uma Requisi√ß√£o que ser√° enviada para a aplica√ß√£o que foi gerada pelo Nest com o ambiente de testes.

**Linha 66:** Define que a Requisi√ß√£o ser√° do tipo **PUT**, atrav√©s do M√©todo **put()**, e enviar√° a Requisi√ß√£o para o endere√ßo do endpoint Atualizar Tarefa (**/tarefas**).

**Linha 67:** Define os dados do Objeto Tarefa que ser√£o enviados no Corpo da Requisi√ß√£o, atrav√©s do M√©todo **send()**. Nesta etapa, o processo √© equivalente ao que o Insomnia faz em uma requisi√ß√£o do tipo **PUT**: Transforma os atributos num Objeto da Classe Tarefa, que ser√° enviado no corpo da requisi√ß√£o (Request Body).

Observe que como se trata de uma atualiza√ß√£o dos dados de uma tarefa, enviaremos o Atributo **id** para identificar o Objeto Tarefa que desejamos atualizar. O id est√° sendo enviado atrav√©s da vari√°vel **tarefaId** (Linha 68), que recebeu o id da tarefa no primeiro teste.

**Linha 75:** Atrav√©s do M√©todo <b>expect()</b>, da Biblioteca SuperTest, checaremos se a Resposta HTTP da Requisi√ß√£o (Response), √© a resposta esperada (**OK ü°™ 200**). Caso o HTTP Status da Resposta da Requisi√ß√£o seja 200, o **Teste Passa**. Caso seja outro  Status, o **Teste Falha**.

**Linha 76:** Atrav√©s do M√©todo <b>then()</b>, da Biblioteca SuperTest, vamos acessar e verificar se a altera√ß√£o foi realmente efetuada, comparando o Atributo nome, que foi recebido no Corpo da Resposta com a altera√ß√£o que foi enviada na Requisi√ß√£o. Observe que a Resposta da Requisi√ß√£o ser√° armazenada no Objeto **resposta**, criado na Arrow Function, dentro do M√©todo then().

**Linha 77:** Atrav√©s do M√©todo de asser√ß√£o <b>expect().toEqual()</b>, do Framework Jest, checaremos se o Atributo nome enviado na Requisi√ß√£o foi persistido no Banco de Dados. Para obter o Atributo nome, recebido no Corpo da Requisi√ß√£o, utilizaremos o M√©todo **resposta.body.nome**. Na sequ√™ncia faremos a compara√ß√£o com o conte√∫do que foi enviado no Atributo nome (Primeira tarefa - Atualizada!) no Corpo da Requisi√ß√£o.

*expect( **Conte√∫do Enviado** ).toEqual( **Conte√∫do Recebido** )*

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="130px"/> | <p align="justify"> **ATEN√á√ÉO:** *Para que o teste **Deve Atualizar uma Tarefa()** seja aprovado, os 2 testes (linhas 75 e 77) devem ser aprovados, caso contr√°rio o Jest indicar√° que o teste Falhou!.* </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |


| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao escrever os testes da aplica√ß√£o. N√£o confunda o M√©todo expect() do Framework Jest com o M√©todo expect() da Biblioteca SuperTest. Embora a escrita seja a mesma, os M√©todos possuem fun√ß√µes diferentes.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/testing" target="_blank"><b>Documenta√ß√£o:  NestJS Testing</b></a></div>

<div align="left"><img src="https://i.imgur.com/3tsv1lE.png" title="source: imgur.com" width="30px"/> <a href="https://jestjs.io/pt-BR/docs/api" target="_blank"><b>Documenta√ß√£o: Jest</b></a></div>

<div align="left"><img src="https://i.imgur.com/3tsv1lE.png" title="source: imgur.com" width="30px"/> <a href="https://jestjs.io/pt-BR/docs/expect" target="_blank"><b>Documenta√ß√£o: M√©todo Expect - Jest</b></a></div>

<div align="left"><img src="https://i.imgur.com/kuK7aM3.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/visionmedia/supertest#readme" target="_blank"><b>Documenta√ß√£o: Supertest</b></a></div>



<h3>M√©todo 04 - N√£o deve atualizar uma Tarefa com Id Inv√°lido</h3>

<div align="center"><img src="https://i.imgur.com/rH4Ss3d.png" title="source: imgur.com" /></div>

**Linha 81:** O M√©todo que executar√° o Teste **N√£o deve atualizar uma Tarefa com Id Inv√°lido** foi criado com o M√©todo **it()** que indica que este M√©todo executar√° um teste.

**Linha 82:** Neste M√©todo, como n√£o iremos extrair nenhum atributo do Corpo da Requisi√ß√£o, n√£o foi criado uma **const**. Utilizamos a palavra **return** que executar√° e retornar√° a Resposta do M√©todo **request()**, que cria uma Requisi√ß√£o que ser√° enviada para a aplica√ß√£o que foi gerada pelo Nest com o ambiente de testes.

**Linha 83:** Define que a Requisi√ß√£o ser√° do tipo **PUT**, atrav√©s do M√©todo **put()**, e enviar√° a Requisi√ß√£o para o endere√ßo do endpoint Atualizar Tarefa (**/tarefas**).

**Linha 84:** Define os dados do Objeto Tarefa que ser√£o enviados no Corpo da Requisi√ß√£o, atrav√©s do M√©todo **send()**. Nesta etapa, o processo √© equivalente ao que o Insomnia faz em uma requisi√ß√£o do tipo **PUT**: Transforma os atributos num Objeto da Classe Tarefa, que ser√° enviado no corpo da requisi√ß√£o (Request Body).

Observe que como se trata de uma atualiza√ß√£o dos dados de uma tarefa, enviaremos o Atributo **id** para identificar o Objeto Tarefa que desejamos atualizar.

| <img src="https://i.imgur.com/nSpXEZ0.png" title="source: imgur.com" width="250px"/> | <p align="justify"> Observe que neste M√©todo temos o objetivo de testar o Erro! (N√£o Deve Atualizar uma Tarefa com Id inv√°lido) e n√£o a atualiza√ß√£o dos dados. Por este motivo enviamos um Objeto com um id inexistente (10000) e verificamos se o aplicativo rejeita a atualiza√ß√£o do Objeto (NOT_FOUND). </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 92:** Atrav√©s do M√©todo <b>expect()</b>, da Biblioteca SuperTest, checaremos se a Resposta HTTP da Requisi√ß√£o (Response), √© a resposta esperada (**NOT_FOUND ü°™ 404**). Caso o HTTP Status da Resposta da Requisi√ß√£o seja 404 (n√£o encontrou a Tarefa), o **Teste Passa**. Caso seja outro Status, o **Teste Falha**.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/testing" target="_blank"><b>Documenta√ß√£o:  NestJS Testing</b></a></div>

<div align="left"><img src="https://i.imgur.com/3tsv1lE.png" title="source: imgur.com" width="30px"/> <a href="https://jestjs.io/pt-BR/docs/api" target="_blank"><b>Documenta√ß√£o: Jest</b></a></div>

<div align="left"><img src="https://i.imgur.com/3tsv1lE.png" title="source: imgur.com" width="30px"/> <a href="https://jestjs.io/pt-BR/docs/expect" target="_blank"><b>Documenta√ß√£o: M√©todo Expect - Jest</b></a></div>

<div align="left"><img src="https://i.imgur.com/kuK7aM3.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/visionmedia/supertest#readme" target="_blank"><b>Documenta√ß√£o: Supertest</b></a></div>



<h3>M√©todo 05 - Deve Apagar uma Tarefa</h3>

<div align="center"><img src="https://i.imgur.com/DRYB7JB.png" title="source: imgur.com" /></div>

**Linha 95:** O M√©todo que executar√° o Teste **Deve Apagar uma Tarefa** foi criado com o M√©todo **it()** que indica que este M√©todo executar√° um teste.

**Linha 96:** Neste M√©todo, como n√£o iremos extrair nenhum atributo do Corpo da Requisi√ß√£o, n√£o foi criado uma **const**. Utilizamos a palavra **return** que executar√° e retornar√° a Resposta do M√©todo **request()**, que cria uma Requisi√ß√£o que ser√° enviada para a aplica√ß√£o que foi gerada pelo Nest com o ambiente de testes.

**Linha 97:** Define que a Requisi√ß√£o ser√° do tipo **DELETE**, atrav√©s do M√©todo **delete()**, e enviar√° a Requisi√ß√£o para o endere√ßo do endpoint Deletar Tarefa por id (**/tarefas/:id**).

Observe que para enviarmos o id da tarefa na vari√°vel de caminho id, do M√©todo delete(id : number), criamos uma concatena√ß√£o entre o **endere√ßo do M√≥dulo (/tarefas)** e a **vari√°vel auxiliar (tarefaId)**. Desta forma, conseguimos criar o endere√ßo da Requisi√ß√£o: **/tarefas/id_da_tarefa**

**Linha 98:** Como as requisi√ß√µes do tipo **DELETE** n√£o envia dados no corpo da requisi√ß√£o (Request Body), o M√©todo **send()** ficar√° vazio.

**Linha 99:** Atrav√©s do M√©todo <b>expect()</b>, da Biblioteca SuperTest, checaremos se a Resposta HTTP da Requisi√ß√£o (Response), √© a resposta esperada (**NO_CONTENT ü°™ 204**). Caso o HTTP Status da Resposta da Requisi√ß√£o seja 204, o **Teste Passa**. Caso seja outro Status, o **Teste Falha**.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/testing" target="_blank"><b>Documenta√ß√£o:  NestJS Testing</b></a></div>

<div align="left"><img src="https://i.imgur.com/3tsv1lE.png" title="source: imgur.com" width="30px"/> <a href="https://jestjs.io/pt-BR/docs/api" target="_blank"><b>Documenta√ß√£o: Jest</b></a></div>

<div align="left"><img src="https://i.imgur.com/kuK7aM3.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/visionmedia/supertest#readme" target="_blank"><b>Documenta√ß√£o: Supertest</b></a></div>

<br />

Abaixo voc√™ confere a vers√£o final da Classe de testes:

```javascript
import { INestApplication } from '@nestjs/common';
import { Test, TestingModule } from '@nestjs/testing';
import { TypeOrmModule } from '@nestjs/typeorm';
import * as request from 'supertest';
import { AppModule } from './../src/app.module';

describe('Testes do M√≥dulo Tarefa (e2e)', () => {

  let tarefaId: any;

  let app: INestApplication;

  beforeAll(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [
        TypeOrmModule.forRoot({
          type: 'mysql',
          host: 'localhost',
          port: 3306,
          username: 'root',
          password: 'root',
          database: 'db_todolist_test',
          autoLoadEntities: true,
          synchronize: true,
          logging: false,
          dropSchema: true
        }),
        AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  afterAll(async () => {
    await app.close();
  });

 
  it('01 - Deve Cadastrar uma Tarefa', async () => {
    const resposta = await request(app.getHttpServer())
      .post('/tarefas')
      .send({
        nome: 'Primeira tarefa',
        descricao: 'Minha primeira tarefa do dia',
        responsavel: 'Respons√°vel 01',
        data: '2022-07-15',
        status: true
      });
    expect(201)

    tarefaId = resposta.body.id;

  });

  it('02 - Deve Listar uma Tarefa Espec√≠fica', async () => {
    return request(app.getHttpServer())
      .get('/tarefas/' + tarefaId)
      .send({})
      .expect(200)

  });

  it('03 - Deve Atualizar uma Tarefa', async () => {
    return await request(app.getHttpServer())
      .put('/tarefas')
      .send({
        id: tarefaId,
        nome: 'Primeira tarefa - Atualizada!',
        descricao: 'Minha primeira tarefa do dia - Atualizada!',
        responsavel: 'Respons√°vel 02',
        data: '2022-08-15',
        status: false
      })
      .expect(200)
      .then(resposta => {
        expect ("Primeira tarefa - Atualizada!").toEqual(resposta.body.nome)
      });
  });

  it('04 - N√£o Deve Atualizar uma Tarefa com Id inv√°lido', async () => {
    return await request(app.getHttpServer())
      .put('/tarefas')
      .send({
        id: 10000,
        nome: 'Primeira tarefa - Atualizada!',
        descricao: 'Minha primeira tarefa do dia - Atualizada!',
        responsavel: 'Respons√°vel 02',
        data: '2022-08-15',
        status: false
      })
      .expect(404)
  });

  it('05 - Deve Apagar uma Tarefa Espec√≠fica', async () => {
    return request(app.getHttpServer())
      .delete('/tarefas/' + tarefaId)
      .send({})
      .expect(204)
  });

});
```

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_todolist_nest/blob/11_Testes_Jest/todolist/test/app.e2e-spec.ts" target="_blank"><b>C√≥digo fonte: app.e2e-spec.ts</b></a> 
</div>


<h2>üë£ Passo 02 - Executando os Testes no VSCode</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/kXggbYz.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run test:e2e***, para compilar e executar os testes do nosso projeto **blogpessoal**. 

```bash
npm run test:e2e
```

3. Se tudo deu certo, o resultado ser√° semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/4aOT9vt.png" title="source: imgur.com" /></div>

4. Observe na imagem acima que todos os testes foram aprovados.
5. Caso algum teste n√£o seja aprovado, ser√° exibida uma mensagem semelhante a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/pklGgYQ.png" title="source: imgur.com" /></div>

6. Observe no exemplo acima, que o **Teste N√£o Deve Atualizar uma Tarefa com Id inv√°lido** estava esperando o HTTP Status 404 (**NOT_FOUND**) e recebeu o HTTP Status 200 (**OK**). Por isso o teste falhou!


| <img src="https://i.imgur.com/L338M2G.png" title="source: imgur.com" width="138px"/> | **DESAFIO:** *Fa√ßa algumas altera√ß√µes nos dados dos Objetos e/ou escreva outros testes para praticar. A melhor forma de aprender e compreender como funcionam os testes √© praticando! * |
| ------------------------------------------------------------ | :----------------------------------------------------------- |

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/rafaelq80/backend_todolist_nest/tree/11_Testes_Jest" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br />

<h2>‚úî Boas pr√°ticas</h2>

1. **Fa√ßa testes pequenos.**
2. **Fa√ßa testes r√°pidos:** Os testes devem ser simples e objetivos porqu√™ ser√£o executados o tempo todo.
3. **Fa√ßa testes determin√≠sticos:** O teste deve garantir o resultado.
4. **Utilize nomes auto descritivos:** A ideia √© que voc√™ entenda o que o teste faz sem precisar abri-lo.
6. **Insira poucas asser√ß√µes em cada teste:** O objetivo √© que um teste seja respons√°vel por apenas uma verifica√ß√£o.
7. **Sempre avalie os resultados dos seus testes.**

<br /> <br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
